# 创建 test.sh 脚本方案

## 1. 脚本创建

创建一个名为 `test.sh` 的 bash 脚本，用于测试所有数据集（包括新增的 MVTec2），使用 ./ckpt 目录下的 checkpoint，并将测试结果保存到 ./results 目录。

## 2. 脚本结构

参考原本 `scripts.sh` 文件的结构，创建只包含测试部分的脚本：

- 定义数据集数组，包括所有数据集（添加 MVTec2）
- 设置 checkpoint 路径为 ./ckpt
- 创建 results 目录（如果不存在）
- 循环测试每个数据集
- 将测试结果保存到 ./results 目录

## 3. 数据集列表

需要测试的数据集包括：
- MVTec
- BTAD
- MPDD
- Brain
- Liver
- Retina
- Colon_clinicDB
- Colon_colonDB
- Colon_Kvasir
- Colon_cvc300
- VisA
- MVTec2（新增）

## 4. 实现步骤

1. **创建脚本文件**：创建 `test.sh` 文件
2. **设置数据集数组**：定义包含所有数据集的数组
3. **设置 checkpoint 路径**：设置为 ./ckpt
4. **创建 results 目录**：确保 results 目录存在
5. **循环测试每个数据集**：对每个数据集运行测试命令
6. **保存测试结果**：将测试结果保存到 ./results 目录

## 5. 脚本内容

```bash
#!/bin/bash

# 创建 results 目录
mkdir -p ./results

# 定义数据集数组
declare -a dataset=(MVTec BTAD MPDD Brain Liver Retina Colon_clinicDB Colon_colonDB Colon_Kvasir Colon_cvc300 VisA MVTec2)

# 设置 checkpoint 路径
save_path="./ckpt"

# 循环测试每个数据集
for i in "${dataset[@]}"; do
    echo "Testing $i..."
    # 运行测试命令
    python test.py --save_path $save_path --dataset $i
    # 将测试结果复制到 results 目录
    if [ -f "$save_path/test.log" ]; then
        cp "$save_path/test.log" "./results/${i}_test.log"
        echo "Test results for $i saved to ./results/${i}_test.log"
    fi
done

echo "All tests completed!"
```

## 6. 运行命令

```bash
chmod +x test.sh
./test.sh
```

## 7. 预期输出

- `./results` 目录中会为每个数据集创建一个测试结果文件，命名为 `${dataset}_test.log`
- 每个测试结果文件包含该数据集的测试指标和日志